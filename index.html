<!DOCTYPE html>
<html>
    <head>
        <title>Factory Farm</title>
    <meta content="text/html;charset=utf-8" http-equiv="Content-Type">
    <meta content="utf-8" http-equiv="encoding">
        <link rel="stylesheet" type="text/css" href="stylesheet.css" />
        <!-- font -->
    <link rel="shortcut icon" type="image/x-icon" href="assets/images/favoicon.png"> 
    <!-- <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'> -->
    <!--   <meta name="viewport"   content="user-scalable=yes, initial-scale=1.0" /> -->
    <script src="lib/crafty.js"></script>
    <script src="./src/colors.js"></script>
    <script src="./src/game.js"></script>
    <script src="./src/map.js"></script>
    <script src="./src/params.js"></script>
    <script src="./src/utility.js"></script>
    <script src="./src/components/comp_Chicken.js"></script>
    <script src="./src/components/comp_Feeder.js"></script>
    <script src="./src/components/comp_KeyControls.js"></script>
    <script src="./src/components/comp_Moving.js"></script>
    <script src="./src/components/comp_OriginCoordinates.js"></script>
    <script src="./src/components/comp_Popup.js"></script>
    <script src="./src/components/comp_ReelFromVelocity.js"></script>
    <script src="./src/components/comp_Seller.js"></script>
    <script src="./src/components/comp_Wall.js"></script>
    <script src="./src/scenes/scene_HowToPlay.js"></script>
    <script src="./src/scenes/scene_Loading.js"></script>
    <script src="./src/scenes/scene_Main.js"></script>
    <script src="./src/scenes/scene_StartScreen.js"></script>
    <script src="./assets/assetsObject.js"></script>
    <script src="./assets/names.js"></script>
    <script src="./assets/images/imageMap.js"></script>
    <script src="./assets/sound/soundMap.js"></script>
    <script>
      window.addEventListener('load', Game.start);
    </script>
    
    <!--  Thumbnail voor Facebook enzo. ;) -->
    <link rel="image_src" href="scrshot.png"/>  
  </head>
  <body>
    <!--Add your own HTML!-->   
    <div id="cr-stage">
    </div>
    <div id="chickenPopupContainer">
      <div id="chickenPopup" style="visibility: hidden;">
      </div>
    </div>
    <div id="info" style="visibility: hidden;">
      <div id="moneyText"></div>
      <div id="chickensText"></div>
      <div id="hotbar" onclick="Crafty('KeyControls').select(parseInt(event.target.id.substr(12, 1)))">
        <div class="hotbar-item" id="hotbar-item-1" title="Chicken">1</div>
        <div class="hotbar-item" id="hotbar-item-2" title="Fence">2</div>
        <div class="hotbar-item" id="hotbar-item-3" title="Feeder">3</div>
      </div>
      <div id="dayText">Day 1</div>
      <div id="timeText">06:00</div>
    </div>
    <script type="text/x-vertex-shader" id="vertex-shader">
      uniform vec4 uViewport;
uniform mediump vec2 uTextureDimensions;

attribute vec2 aPosition;
attribute vec3 aOrientation;
attribute vec2 aLayer;
attribute vec2 aTextureCoord;
attribute vec2 aGrimness;

varying mediump vec3 vTextureCoord;
varying mediump mat4 vColorMatrix;

const mat4 happyColorMatrix = mat4(
	1.0, 0.0, 0.0, 0.0,
	0.0, 1.0, 0.0, 0.0,
	0.0, 0.0, 1.0, 0.0,
	0.0, 0.0, 0.0, 0.0
);
const mat4 grimColorMatrix = mat4(
	0.7, 0.5, 0.4, 0.0,
	0.5, 0.7, 0.4, 0.0,
	0.5, 0.5, 0.9, 0.0,
	-0.2, -0.2, -0.2, 0.0
);

void main() {
	mat4 viewportScale = mat4(
			2.0 / uViewport.z, 0, 0, 0,
			0, -2.0 / uViewport.w, 0,0,
			0, 0,1,0,
			-1,+1,0,1);
	vec4 viewportTranslation = vec4(uViewport.xy, 0, 0);

	vec2 pos = aPosition;
	vec2 entityOrigin = aOrientation.xy;
	mat2 entityRotationMatrix = mat2(cos(aOrientation.z), sin(aOrientation.z), -sin(aOrientation.z), cos(aOrientation.z));
	pos = entityRotationMatrix * (pos - entityOrigin) + entityOrigin ;
	gl_Position = viewportScale * (viewportTranslation + vec4(pos, 1.0/(1.0+exp(aLayer.x) ), 1) );
	vTextureCoord = vec3(aTextureCoord, aLayer.y);

	vColorMatrix = mat4(
			mix(happyColorMatrix[0], grimColorMatrix[0], aGrimness.x),
			mix(happyColorMatrix[1], grimColorMatrix[1], aGrimness.x),
			mix(happyColorMatrix[2], grimColorMatrix[2], aGrimness.x),
			mix(happyColorMatrix[3], grimColorMatrix[3], aGrimness.x));
}

    </script>
    <script type="text/x-fragment-shader" id="fragment-shader">
      precision mediump float;

uniform sampler2D uSampler;
uniform mediump vec2 uTextureDimensions;

varying mediump vec3 vTextureCoord;
varying mediump mat4 vColorMatrix;

void main() {
	highp vec2 coord =   vTextureCoord.xy / uTextureDimensions;
	mediump vec4 baseColor = texture2D(uSampler, coord);
	vec3 color = (vColorMatrix * vec4(baseColor.rgb, 1.0)).rgb * baseColor.a * vTextureCoord.z;
	float alpha = baseColor.a * vTextureCoord.z;
	gl_FragColor = vec4(color, alpha);
}

    </script>
  </body>
</html>